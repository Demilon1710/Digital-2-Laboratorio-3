//Librerías
#include <Arduino.h>
#include <stdint.h>


// put function declarations here:

// Definir pines para leds y botones.
#define LEDB 15 //Led azul
#define LEDY 2 //Led amarillo
#define LEDR 18 //Led rojo
#define LEDO 19 //Led naranja
#define BTN1 13 //Boton suma
#define BTN2 12 //Boton resta
#define antiBounce 300 //Milisegundos para antirrebote

//Prototipo de funciones
void initBTN1(void);
void IRAM_ATTR BTN1_ISR(void); //Funciones para interrupciones de los botones
void initBTN2(void);
void IRAM_ATTR BTN2_ISR(void);

//Variables globales
volatile int32_t contador; //Se tomarán en cuenta valores negativos, por lo que son enteros de ambos signos.
volatile bool btn1ON; //Variable booleana para marcar que se presionó el botón.
volatile uint32_t lastISRbtn1 = 0; //Última presionada del botón.
volatile bool btn2ON;
volatile uint32_t lastISRbtn2 = 0;

void IRAM_ATTR BTN1_ISR(void){ //Función que permite el antirrebote.
  uint32_t tiempoActual = millis(); //Millis permite contar el tiempo desde el inicio del programa.
  if(tiempoActual - lastISRbtn1 > antiBounce){ //Ciclo if para sumar al contador si se cumplen las condiciones del interruptor 1
  btn1ON = true;
  contador++;
  lastISRbtn1 = tiempoActual;
  }
}
void IRAM_ATTR BTN2_ISR(void){ //Ciclo if para restar al contador si se cumplen las condiciones del interruptor 2
  uint32_t tiempoActual = millis();
  if(tiempoActual - lastISRbtn2 > antiBounce){
  btn2ON = true;
  contador--;
  lastISRbtn2 = tiempoActual;
  }
  }

void setup() {
  // Configurar pines como entradas o salidas
  Serial.begin(115200); //Iniciar la serialización para los comandos de texto.
  initBTN1();  //Llamar a la función para inicializar los botones.
  initBTN2();
  contador = 0; //Darle un valor inicial a los contadores.
  pinMode(LEDB, OUTPUT); //Indicar si los pines utilizados funcionarán como entradas o salidas.
  pinMode(LEDY, OUTPUT);
  pinMode(LEDR, OUTPUT);
  pinMode(LEDO, OUTPUT);
}

void loop() {
  if(btn1ON){
  btn1ON = false;
  Serial.println("Se ha sumado >"); //Print serial para probar el funcionamiento del botón
  Serial.println(contador);
   }
  if(btn2ON){
    btn2ON = false;
    Serial.println("Se ha restado >");
    Serial.println(contador);
  }
  if(contador == 0){
    digitalWrite(LEDB, LOW);
    digitalWrite(LEDY, LOW);
    digitalWrite(LEDR, LOW);
    digitalWrite(LEDO, LOW);
  }
  if(contador == 1){
    digitalWrite(LEDB, LOW);
    digitalWrite(LEDY, LOW);
    digitalWrite(LEDR, LOW);
    digitalWrite(LEDO, HIGH);
  }
  if(contador == 2){
    digitalWrite(LEDB, LOW);
    digitalWrite(LEDY, LOW);
    digitalWrite(LEDR, HIGH);
    digitalWrite(LEDO, LOW);
  }
  if(contador == 3){
    digitalWrite(LEDB, LOW);
    digitalWrite(LEDY, LOW);
    digitalWrite(LEDR, HIGH);
    digitalWrite(LEDO, HIGH);
  }
  if(contador == 4){
    digitalWrite(LEDB, LOW);
    digitalWrite(LEDY, HIGH);
    digitalWrite(LEDR, LOW);
    digitalWrite(LEDO, LOW);
  }
  if(contador == 5){
    digitalWrite(LEDB, LOW);
    digitalWrite(LEDY, HIGH);
    digitalWrite(LEDR, LOW);
    digitalWrite(LEDO, HIGH);
  }
  if(contador == 6){
    digitalWrite(LEDB, LOW);
    digitalWrite(LEDY, HIGH);
    digitalWrite(LEDR, HIGH);
    digitalWrite(LEDO, LOW);
  }
  if(contador == 7){
    digitalWrite(LEDB, LOW);
    digitalWrite(LEDY, HIGH);
    digitalWrite(LEDR, HIGH);
    digitalWrite(LEDO, HIGH);
  }
  if(contador == 8){
    digitalWrite(LEDB, HIGH);
    digitalWrite(LEDY, LOW);
    digitalWrite(LEDR, LOW);
    digitalWrite(LEDO, LOW);
  }
  if(contador == 9){
    digitalWrite(LEDB, HIGH);
    digitalWrite(LEDY, LOW);
    digitalWrite(LEDR, LOW);
    digitalWrite(LEDO, HIGH);
  }
  if(contador == 10){
    digitalWrite(LEDB, HIGH);
    digitalWrite(LEDY, LOW);
    digitalWrite(LEDR, HIGH);
    digitalWrite(LEDO, LOW);
  }
  if(contador == 11){
    digitalWrite(LEDB, HIGH);
    digitalWrite(LEDY, LOW);
    digitalWrite(LEDR, HIGH);
    digitalWrite(LEDO, HIGH);
  }
  if(contador == 12){
    digitalWrite(LEDB, HIGH);
    digitalWrite(LEDY, HIGH);
    digitalWrite(LEDR, LOW);
    digitalWrite(LEDO, LOW);
  }
  if(contador == 13){
    digitalWrite(LEDB, HIGH);
    digitalWrite(LEDY, HIGH);
    digitalWrite(LEDR, LOW);
    digitalWrite(LEDO, HIGH);
  }
  if(contador == 14){
    digitalWrite(LEDB, HIGH);
    digitalWrite(LEDY, HIGH);
    digitalWrite(LEDR, HIGH);
    digitalWrite(LEDO, LOW);
  }
  if(contador == 15){
    digitalWrite(LEDB, HIGH);
    digitalWrite(LEDY, HIGH);
    digitalWrite(LEDR, HIGH);
    digitalWrite(LEDO, HIGH);
  }
  if(contador > 15){ //Crear un ciclo entre los valores que puede alcanzar el contador.
    contador = 0;
  }
  if(contador < 0){
    contador = 15;
  }
   
  } 

void initBTN1(void){
  //Funciones para denominar a los botones con su tipo de entrada y su interruptor.
  pinMode(BTN1, INPUT_PULLUP);
  attachInterrupt(BTN1, &BTN1_ISR, FALLING); //Se indica el pin del botón, su función de interrupción y el tipo de señal donde se interrumpe.
}
void initBTN2(void){
  pinMode(BTN2, INPUT_PULLDOWN);
  attachInterrupt(BTN2, &BTN2_ISR, RISING);
}
